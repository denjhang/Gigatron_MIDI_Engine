_startAddress_                    EQU                          0x0200

; Internal Variables
serialRawPrev                     EQU                          0x0081
frameCountPrev                    EQU                          0x00d6
register0                         EQU                          0x0082
register1                         EQU                          register0 + 0x02
register2                         EQU                          register0 + 0x04
register3                         EQU                          register0 + 0x06
register4                         EQU                          register0 + 0x08
register5                         EQU                          register0 + 0x0A
register6                         EQU                          register0 + 0x0C
register7                         EQU                          register0 + 0x0E
register8                         EQU                          register0 + 0x10
register9                         EQU                          register0 + 0x12
register10                        EQU                          register0 + 0x14
register11                        EQU                          register0 + 0x16
register12                        EQU                          register0 + 0x18
register13                        EQU                          register0 + 0x1A
register14                        EQU                          register0 + 0x1C
register15                        EQU                          register0 + 0x1E
fgbgColour                        EQU                          register0 + 0x20
cursorXY                          EQU                          register0 + 0x22
midiStream                        EQU                          register0 + 0x24
midiDelay                         EQU                          register0 + 0x26
miscFlags                         EQU                          register0 + 0x28
register16                        EQU                          register0 + 0x2A
timerTick                         EQU                          register0 + 0x2C
timerJiff                         EQU                          register0 + 0x2E

; Internal Constants
MISC_WAIT_VBLANK_BIT              EQU                          0x01
MISC_ENABLE_SCROLL_BIT            EQU                          0x02
MISC_ON_BOTTOM_ROW_BIT            EQU                          0x04
MISC_DISABLE_CLIP_BIT             EQU                          0x08
MISC_ENABLE_FNT4X6_BIT            EQU                          0x10
MISC_WAIT_VBLANK_MSK              EQU                          0xfe
MISC_ENABLE_SCROLL_MSK            EQU                          0xfd
MISC_ON_BOTTOM_ROW_MSK            EQU                          0xfb
MISC_DISABLE_CLIP_MSK             EQU                          0xf7
MISC_ENABLE_FNT4X6_MSK            EQU                          0xef

; Internal Buffers
regsWorkArea                      EQU                          0x0000
textWorkArea                      EQU                          0xffa0

; Includes
%includePath                      "../runtime"
%include                          util.i
%include                          gigatron.i
%include                          macros_ROMv5a.i

; Labels
_entryPoint_                      EQU                          0x0200
_wait_0                           EQU                          0x0ef8
_fix                              EQU                          0x025a
_endif_0x0000                     EQU                          0x0269
_endif_0x0001                     EQU                          0x0279
_endif_0x0002                     EQU                          0x0289
_endif_0x0003                     EQU                          0x0299
_endif_0x0004                     EQU                          0x02a9
_endif_0x0005                     EQU                          0x02b9
_endif_0x0006                     EQU                          0x02c9
_endif_0x0007                     EQU                          0x02d9
_fix_oct0                         EQU                          0x02db
_endif_0x0008                     EQU                          0x02eb
_endif_0x0009                     EQU                          0x030a
_endif_0x000a                     EQU                          0x031b
_endif_0x000b                     EQU                          0x032c
_endif_0x000c                     EQU                          0x033d
_endif_0x000d                     EQU                          0x034e
_endif_0x000e                     EQU                          0x035f
_endif_0x000f                     EQU                          0x0370
_endif_0x0010                     EQU                          0x0381
_endif_0x0011                     EQU                          0x0392
_endif_0x0012                     EQU                          0x03a3
_endif_0x0013                     EQU                          0x03b4
_fix_oct1                         EQU                          0x03b6
_endif_0x0014                     EQU                          0x03c6
_endif_0x0015                     EQU                          0x03d7
_endif_0x0016                     EQU                          0x03e8
_endif_0x0017                     EQU                          0x0402
_endif_0x0018                     EQU                          0x0413
_endif_0x0019                     EQU                          0x0424
_endif_0x001a                     EQU                          0x0435
_endif_0x001b                     EQU                          0x0446
_endif_0x001c                     EQU                          0x0457
_endif_0x001d                     EQU                          0x0468
_endif_0x001e                     EQU                          0x0479
_endif_0x001f                     EQU                          0x048a
_fix_oct2                         EQU                          0x048c
_endif_0x0020                     EQU                          0x049c
_endif_0x0021                     EQU                          0x04ad
_endif_0x0022                     EQU                          0x04be
_endif_0x0023                     EQU                          0x04cf
_endif_0x0024                     EQU                          0x04e0
_endif_0x0025                     EQU                          0x04f1
_endif_0x0026                     EQU                          0x050d
_endif_0x0027                     EQU                          0x051e
_endif_0x0028                     EQU                          0x052f
_endif_0x0029                     EQU                          0x0540
_endif_0x002a                     EQU                          0x0551
_endif_0x002b                     EQU                          0x0562
_fix_oct3                         EQU                          0x0564
_endif_0x002c                     EQU                          0x0574
_endif_0x002d                     EQU                          0x0585
_endif_0x002e                     EQU                          0x0596
_endif_0x002f                     EQU                          0x05a7
_endif_0x0030                     EQU                          0x05b8
_endif_0x0031                     EQU                          0x05c9
_endif_0x0032                     EQU                          0x05da
_endif_0x0033                     EQU                          0x05eb
_endif_0x0034                     EQU                          0x0600
_endif_0x0035                     EQU                          0x0611
_endif_0x0036                     EQU                          0x0622
_endif_0x0037                     EQU                          0x0633
_fix_oct4                         EQU                          0x0635
_endif_0x0038                     EQU                          0x0645
_endif_0x0039                     EQU                          0x0656
_endif_0x003a                     EQU                          0x0667
_endif_0x003b                     EQU                          0x0678
_endif_0x003c                     EQU                          0x0689
_endif_0x003d                     EQU                          0x069a
_endif_0x003e                     EQU                          0x06ab
_endif_0x003f                     EQU                          0x06bc
_endif_0x0040                     EQU                          0x06cd
_endif_0x0041                     EQU                          0x06de
_endif_0x0042                     EQU                          0x06ef
_endif_0x0043                     EQU                          0x08a4
_fix_oct5                         EQU                          0x08a6
_endif_0x0044                     EQU                          0x08b6
_endif_0x0045                     EQU                          0x08c7
_endif_0x0046                     EQU                          0x08d8
_endif_0x0047                     EQU                          0x08e9
_endif_0x0048                     EQU                          0x08fa
_endif_0x0049                     EQU                          0x09af
_endif_0x004a                     EQU                          0x09c0
_endif_0x004b                     EQU                          0x09d1
_endif_0x004c                     EQU                          0x09e2
_endif_0x004d                     EQU                          0x09f3
_endif_0x004e                     EQU                          0x0aaa
_endif_0x004f                     EQU                          0x0abb
_fix_oct6                         EQU                          0x0abd
_endif_0x0050                     EQU                          0x0acd
_endif_0x0051                     EQU                          0x0ade
_endif_0x0052                     EQU                          0x0aef
_endif_0x0053                     EQU                          0x0ba4
_endif_0x0054                     EQU                          0x0bb5
_endif_0x0055                     EQU                          0x0bc6
_endif_0x0056                     EQU                          0x0bd7
_endif_0x0057                     EQU                          0x0be8
_endif_0x0058                     EQU                          0x0bf9
_endif_0x0059                     EQU                          0x0cad
_endif_0x005a                     EQU                          0x0cbe
_endif_0x005b                     EQU                          0x0ccf
_fix_oct7                         EQU                          0x0cd1
_endif_0x005c                     EQU                          0x0ce1
_endif_0x005d                     EQU                          0x0cf2
_endif_0x005e                     EQU                          0x0daa
_endif_0x005f                     EQU                          0x0dbb
_endif_0x0060                     EQU                          0x0dcc
_endif_0x0061                     EQU                          0x0ddd
_endif_0x0062                     EQU                          0x0dee
_endif_0x0063                     EQU                          0x0ea2
_endif_0x0064                     EQU                          0x0eb3
_endif_0x0065                     EQU                          0x0ec4
_endif_0x0066                     EQU                          0x0ed5
_endif_0x0067                     EQU                          0x0ee6
_stop_music                       EQU                          0x0ee8
_repeat_0x0068                    EQU                          0x0ee9
_eatSound_Timer                   EQU                          0x0ef3
_endif_0x0069                     EQU                          0x0fa9
_else_0x006a                      EQU                          0x0fd5
_endif_0x006b                     EQU                          0x0fdc
_beep                             EQU                          0x0fde
_music_data                       EQU                          0x11d3
_page_0x0300                      EQU                          0x0300
_page_0x0400                      EQU                          0x0400
_page_0x0500                      EQU                          0x0500
_page_0x08a0                      EQU                          0x08a0
_page_0x09a0                      EQU                          0x09a0
_page_0x0aa0                      EQU                          0x0aa0
_page_0x0ba0                      EQU                          0x0ba0
_page_0x0ca0                      EQU                          0x0ca0
_page_0x0da0                      EQU                          0x0da0
_page_0x0ea0                      EQU                          0x0ea0
_page_0x0fa0                      EQU                          0x0fa0
_page_0x10a0                      EQU                          0x10a0
_page_0x11a0                      EQU                          0x11a0
_page_0x12a0                      EQU                          0x12a0
_page_0x13a0                      EQU                          0x13a0
_page_0x14a0                      EQU                          0x14a0
_page_0x15a0                      EQU                          0x15a0
_page_0x16a0                      EQU                          0x16a0
_page_0x17a0                      EQU                          0x17a0
_page_0x18a0                      EQU                          0x18a0
_page_0x19a0                      EQU                          0x19a0
_page_0x1aa0                      EQU                          0x1aa0
_page_0x1ba0                      EQU                          0x1ba0

; Constants

; Global Variables
_index                            EQU                          0x0030
_fix_num                          EQU                          0x0032
_oct                              EQU                          0x0034
_button                           EQU                          0x0036
_keystat                          EQU                          0x0038
_demo                             EQU                          0x003a
_old_timer                        EQU                          0x003c
_tick_note_ext                    EQU                          0x003e
_wave                             EQU                          0x0040
_vol                              EQU                          0x0042
_tick_sum                         EQU                          0x0044

; Local Variables
_eatSound_Timer_tick_note         EQU                          0x00c4
_beep_ch                          EQU                          0x00c4
_beep_note                        EQU                          0x00c6
_beep_vol                         EQU                          0x00c8
_beep_wave                        EQU                          0x00ca
_beep_Pitch_Bend                  EQU                          0x00cc
_beep_n                           EQU                          0x00ce

; Arrays
_enotes                           EQU                          0x7fca
_enotes                           DB                           0x3d 0x3e 0x3f 0x40 0x41 0x42 0x43 0x44 0x45 0x46 0x47 0x48 0x48 

; Strings

; Constant Strings
_str_0x7fd7                       EQU                          0x7fd7
_str_0x7fd7                       DB                           39 'sound on and midi_note test by denjhang' 0

; Data

; Time

; Define Bytes

; Define Words

; Define Images

; Define Loader Image Chunks

; Define Midis

; Define Blits

; Define Fonts

; Define Sprites

; Define Patterns

; Lookup Tables

; Lazy Constants

; Code
_entryPoint_                      LDI                          0x40
                                  STW                          romUser
                                  RomCheck                     
                                  Initialise                                                ; INIT

                                  LD                           0x21
                                  ORI                          0x03
                                  ST                           33                           ; poke &h21, peek(&h21) OR 3

                                  SoundAllOff                                               ; sound off

                                  ClearVertBlinds                                           ; cls

                                  PrintString                  _str_0x7fd7
                                  NewLine                                                   ; print "sound on and midi_note test by denjhang"

                                  LDI                          1
                                  STW                          _wave                        ; wave=1

                                  LDI                          63
                                  STW                          _vol                         ; vol=63

                                  LDI                          0
                                  STW                          _index                       ; index=0

                                  LDI                          5
                                  STW                          _oct                         ; oct=5

                                  LDI                          0
                                  STW                          _tick_sum                    ; tick_sum=0

                                  LDI                          255
                                  ST                           giga_soundTimer              ; set sound_timer,255

                                  LD                           giga_soundTimer
                                  STW                          _old_timer                   ; old_timer=get("SOUND_TIMER")

                                  CALLI                        _music_data                  ; call music_data

                                  CALLI                        _stop_music                  ; call stop_music

_fix                              PUSH                                                      ; proc fix

                                  LDW                          _oct
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0000 2140           ; if oct==0

                                  CALLI                        _fix_oct0                    ; call fix_oct0

_endif_0x0000                     LDW                          _oct
                                  XORI                         1
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0001 2141           ; if oct==1

                                  CALLI                        _fix_oct1                    ; call fix_oct1

_endif_0x0001                     LDW                          _oct
                                  XORI                         2
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0002 2142           ; if oct==2

                                  CALLI                        _fix_oct2                    ; call fix_oct2

_endif_0x0002                     LDW                          _oct
                                  XORI                         3
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0003 2143           ; if oct==3

                                  CALLI                        _fix_oct3                    ; call fix_oct3

_endif_0x0003                     LDW                          _oct
                                  XORI                         4
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0004 2144           ; if oct==4

                                  CALLI                        _fix_oct4                    ; call fix_oct4

_endif_0x0004                     LDW                          _oct
                                  XORI                         5
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0005 2145           ; if oct==5

                                  CALLI                        _fix_oct5                    ; call fix_oct5

_endif_0x0005                     LDW                          _oct
                                  XORI                         6
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0006 2146           ; if oct==6

                                  CALLI                        _fix_oct6                    ; call fix_oct6

_endif_0x0006                     LDW                          _oct
                                  XORI                         7
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0007 2147           ; if oct==7

                                  CALLI                        _fix_oct6                    ; call fix_oct6

_endif_0x0007                     Return                                                    ; endproc

_fix_oct0                         PUSH                                                      ; proc fix_oct0

                                  LDW                          _index
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0008 2148           ; if index == 0

                                  LDI                          67
                                  STW                          _fix_num                     ; fix_num=67

_endif_0x0008                     LDW                          _index
                                  XORI                         1
                                  CALLI                        convertEqOp
                                  CALLI                        _page_0x0300
_page_0x0300                      JumpFalse                    _endif_0x0009 2149           ; if index == 1

                                  LDI                          71
                                  STW                          _fix_num                     ; fix_num=(67+74)/2

_endif_0x0009                     LDW                          _index
                                  XORI                         2
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x000a 2150           ; if index == 2

                                  LDI                          74
                                  STW                          _fix_num                     ; fix_num=74

_endif_0x000a                     LDW                          _index
                                  XORI                         3
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x000b 2151           ; if index == 3

                                  LDI                          80
                                  STW                          _fix_num                     ; fix_num=(74+86)/2

_endif_0x000b                     LDW                          _index
                                  XORI                         4
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x000c 2152           ; if index == 4

                                  LDI                          86
                                  STW                          _fix_num                     ; fix_num=86

_endif_0x000c                     LDW                          _index
                                  XORI                         5
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x000d 2153           ; if index == 5

                                  LDI                          86
                                  STW                          _fix_num                     ; fix_num=86

_endif_0x000d                     LDW                          _index
                                  XORI                         6
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x000e 2154           ; if index == 6

                                  LDI                          95
                                  STW                          _fix_num                     ; fix_num=(86+104)/2

_endif_0x000e                     LDW                          _index
                                  XORI                         7
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x000f 2155           ; if index == 7

                                  LDI                          104
                                  STW                          _fix_num                     ; fix_num=104

_endif_0x000f                     LDW                          _index
                                  XORI                         8
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0010 2156           ; if index == 8

                                  LDI                          52
                                  STW                          _fix_num                     ; fix_num=(104+0)/2

_endif_0x0010                     LDW                          _index
                                  XORI                         9
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0011 2157           ; if index == 9

                                  LDI                          0
                                  STW                          _fix_num                     ; fix_num=0

_endif_0x0011                     LDW                          _index
                                  XORI                         10
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0012 2158           ; if index == 10

                                  LDI                          2
                                  STW                          _fix_num                     ; fix_num=(0+3)/2

_endif_0x0012                     LDW                          _index
                                  XORI                         11
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0013 2159           ; if index == 11

                                  LDI                          3
                                  STW                          _fix_num                     ; fix_num=3

_endif_0x0013                     Return                                                    ; endproc

_fix_oct1                         PUSH                                                      ; proc fix_oct1

                                  LDW                          _index
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0014 2160           ; if index == 0

                                  LDI                          13
                                  STW                          _fix_num                     ; fix_num=13

_endif_0x0014                     LDW                          _index
                                  XORI                         1
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0015 2161           ; if index == 1

                                  LDI                          24
                                  STW                          _fix_num                     ; fix_num=(13+34)/2

_endif_0x0015                     LDW                          _index
                                  XORI                         2
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0016 2162           ; if index == 2

                                  LDI                          34
                                  STW                          _fix_num                     ; fix_num=34

_endif_0x0016                     LDW                          _index
                                  XORI                         3
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0017 2163           ; if index == 3

                                  LDI                          39
                                  CALLI                        _page_0x0400
_page_0x0400                      STW                          _fix_num                     ; fix_num=(34+44)/2

_endif_0x0017                     LDW                          _index
                                  XORI                         4
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0018 2164           ; if index == 4

                                  LDI                          44
                                  STW                          _fix_num                     ; fix_num=44

_endif_0x0018                     LDW                          _index
                                  XORI                         5
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0019 2165           ; if index == 5

                                  LDI                          63
                                  STW                          _fix_num                     ; fix_num=63

_endif_0x0019                     LDW                          _index
                                  XORI                         6
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x001a 2166           ; if index == 6

                                  LDI                          71
                                  STW                          _fix_num                     ; fix_num=(63+79)/2

_endif_0x001a                     LDW                          _index
                                  XORI                         7
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x001b 2167           ; if index == 7

                                  LDI                          79
                                  STW                          _fix_num                     ; fix_num=79

_endif_0x001b                     LDW                          _index
                                  XORI                         8
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x001c 2168           ; if index == 8

                                  LDI                          91
                                  STW                          _fix_num                     ; fix_num=(79+103)/2

_endif_0x001c                     LDW                          _index
                                  XORI                         9
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x001d 2169           ; if index == 9

                                  LDI                          103
                                  STW                          _fix_num                     ; fix_num=103

_endif_0x001d                     LDW                          _index
                                  XORI                         10
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x001e 2170           ; if index == 10

                                  LDI                          54
                                  STW                          _fix_num                     ; fix_num=(103+5)/2

_endif_0x001e                     LDW                          _index
                                  XORI                         11
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x001f 2171           ; if index == 11

                                  LDI                          5
                                  STW                          _fix_num                     ; fix_num=5

_endif_0x001f                     Return                                                    ; endproc

_fix_oct2                         PUSH                                                      ; proc fix_oct2

                                  LDW                          _index
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0020 2172           ; if index == 0

                                  LDI                          16
                                  STW                          _fix_num                     ; fix_num=16

_endif_0x0020                     LDW                          _index
                                  XORI                         1
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0021 2173           ; if index == 1

                                  LDI                          37
                                  STW                          _fix_num                     ; fix_num=(16+58)/2

_endif_0x0021                     LDW                          _index
                                  XORI                         2
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0022 2174           ; if index == 2

                                  LDI                          58
                                  STW                          _fix_num                     ; fix_num=58

_endif_0x0022                     LDW                          _index
                                  XORI                         3
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0023 2175           ; if index == 3

                                  LDI                          75
                                  STW                          _fix_num                     ; fix_num=(58+91)/2

_endif_0x0023                     LDW                          _index
                                  XORI                         4
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0024 2176           ; if index == 4

                                  LDI                          91
                                  STW                          _fix_num                     ; fix_num=91

_endif_0x0024                     LDW                          _index
                                  XORI                         5
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0025 2177           ; if index == 5

                                  LDI                          115
                                  STW                          _fix_num                     ; fix_num=115

_endif_0x0025                     LDW                          _index
                                  XORI                         6
                                  CALLI                        _page_0x0500
_page_0x0500                      CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0026 2178           ; if index == 6

                                  LDI                          77
                                  STW                          _fix_num                     ; fix_num=(115+38)/2

_endif_0x0026                     LDW                          _index
                                  XORI                         7
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0027 2179           ; if index == 7

                                  LDI                          38
                                  STW                          _fix_num                     ; fix_num=38

_endif_0x0027                     LDW                          _index
                                  XORI                         8
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0028 2180           ; if index == 8

                                  LDI                          63
                                  STW                          _fix_num                     ; fix_num=(38+87)/2

_endif_0x0028                     LDW                          _index
                                  XORI                         9
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0029 2181           ; if index == 9

                                  LDI                          87
                                  STW                          _fix_num                     ; fix_num=87

_endif_0x0029                     LDW                          _index
                                  XORI                         10
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x002a 2182           ; if index == 10

                                  LDI                          45
                                  STW                          _fix_num                     ; fix_num=(87+2)/2

_endif_0x002a                     LDW                          _index
                                  XORI                         11
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x002b 2183           ; if index == 11

                                  LDI                          2
                                  STW                          _fix_num                     ; fix_num=2

_endif_0x002b                     Return                                                    ; endproc

_fix_oct3                         PUSH                                                      ; proc fix_oct3

                                  LDW                          _index
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x002c 2184           ; if index == 0

                                  LDI                          43
                                  STW                          _fix_num                     ; fix_num=43

_endif_0x002c                     LDW                          _index
                                  XORI                         1
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x002d 2185           ; if index == 1

                                  LDI                          73
                                  STW                          _fix_num                     ; fix_num=(43+102)/2

_endif_0x002d                     LDW                          _index
                                  XORI                         2
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x002e 2186           ; if index == 2

                                  LDI                          102
                                  STW                          _fix_num                     ; fix_num=102

_endif_0x002e                     LDW                          _index
                                  XORI                         3
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x002f 2187           ; if index == 3

                                  LDI                          79
                                  STW                          _fix_num                     ; fix_num=(102+56)/2

_endif_0x002f                     LDW                          _index
                                  XORI                         4
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0030 2188           ; if index == 4

                                  LDI                          56
                                  STW                          _fix_num                     ; fix_num=56

_endif_0x0030                     LDW                          _index
                                  XORI                         5
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0031 2189           ; if index == 5

                                  LDI                          95
                                  STW                          _fix_num                     ; fix_num=95

_endif_0x0031                     LDW                          _index
                                  XORI                         6
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0032 2190           ; if index == 6

                                  LDI                          75
                                  STW                          _fix_num                     ; fix_num=(95+54)/2

_endif_0x0032                     LDW                          _index
                                  XORI                         7
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0033 2191           ; if index == 7

                                  LDI                          54
                                  STW                          _fix_num                     ; fix_num=54

_endif_0x0033                     LDW                          _index
                                  XORI                         8
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0034 2192           ; if index == 8

                                  LDI                          41
                                  STW                          _fix_num                     ; fix_num=(54+27)/2

                                  CALLI                        _endif_0x0034
_endif_0x0034                     LDW                          _index
                                  XORI                         9
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0035 2193           ; if index == 9

                                  LDI                          27
                                  STW                          _fix_num                     ; fix_num=27

_endif_0x0035                     LDW                          _index
                                  XORI                         10
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0036 2194           ; if index == 10

                                  LDI                          24
                                  STW                          _fix_num                     ; fix_num=(27+20)/2

_endif_0x0036                     LDW                          _index
                                  XORI                         11
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0037 2195           ; if index == 11

                                  LDI                          20
                                  STW                          _fix_num                     ; fix_num=20

_endif_0x0037                     Return                                                    ; endproc

_fix_oct4                         PUSH                                                      ; proc fix_oct4

                                  LDW                          _index
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0038 2196           ; if index == 0

                                  LDI                          88
                                  STW                          _fix_num                     ; fix_num=88

_endif_0x0038                     LDW                          _index
                                  XORI                         1
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0039 2197           ; if index == 1

                                  LDI                          88
                                  STW                          _fix_num                     ; fix_num=(88+88)/2

_endif_0x0039                     LDW                          _index
                                  XORI                         2
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x003a 2198           ; if index == 2

                                  LDI                          88
                                  STW                          _fix_num                     ; fix_num=88

_endif_0x003a                     LDW                          _index
                                  XORI                         3
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x003b 2199           ; if index == 3

                                  LDI                          90
                                  STW                          _fix_num                     ; fix_num=(88+91)/2

_endif_0x003b                     LDW                          _index
                                  XORI                         4
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x003c 2200           ; if index == 4

                                  LDI                          91
                                  STW                          _fix_num                     ; fix_num=91

_endif_0x003c                     LDW                          _index
                                  XORI                         5
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x003d 2201           ; if index == 5

                                  LDI                          62
                                  STW                          _fix_num                     ; fix_num=62

_endif_0x003d                     LDW                          _index
                                  XORI                         6
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x003e 2202           ; if index == 6

                                  LDI                          88
                                  STW                          _fix_num                     ; fix_num=(62+113)/2

_endif_0x003e                     LDW                          _index
                                  XORI                         7
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x003f 2203           ; if index == 7

                                  LDI                          113
                                  STW                          _fix_num                     ; fix_num=113

_endif_0x003f                     LDW                          _index
                                  XORI                         8
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0040 2204           ; if index == 8

                                  LDI                          85
                                  STW                          _fix_num                     ; fix_num=(113+56)/2

_endif_0x0040                     LDW                          _index
                                  XORI                         9
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0041 2205           ; if index == 9

                                  LDI                          56
                                  STW                          _fix_num                     ; fix_num=56

_endif_0x0041                     LDW                          _index
                                  XORI                         10
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0042 2206           ; if index == 10

                                  LDI                          49
                                  STW                          _fix_num                     ; fix_num=(56+42)/2

_endif_0x0042                     LDW                          _index
                                  XORI                         11
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0043 2207           ; if index == 11

                                  CALLI                        _page_0x08a0
_page_0x08a0                      LDI                          42
                                  STW                          _fix_num                     ; fix_num=42

_endif_0x0043                     Return                                                    ; endproc

_fix_oct5                         PUSH                                                      ; proc fix_oct5

                                  LDW                          _index
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0044 2208           ; if index == 0

                                  LDI                          23
                                  STW                          _fix_num                     ; fix_num=23

_endif_0x0044                     LDW                          _index
                                  XORI                         1
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0045 2209           ; if index == 1

                                  LDI                          37
                                  STW                          _fix_num                     ; fix_num=(23+51)/2

_endif_0x0045                     LDW                          _index
                                  XORI                         2
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0046 2210           ; if index == 2

                                  LDI                          51
                                  STW                          _fix_num                     ; fix_num=51

_endif_0x0046                     LDW                          _index
                                  XORI                         3
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0047 2211           ; if index == 3

                                  LDI                          71
                                  STW                          _fix_num                     ; fix_num=(51+91)/2

_endif_0x0047                     LDW                          _index
                                  XORI                         4
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0048 2212           ; if index == 4

                                  LDI                          91
                                  STW                          _fix_num                     ; fix_num=91

_endif_0x0048                     LDW                          _index
                                  CALLI                        _page_0x09a0
_page_0x09a0                      XORI                         5
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0049 2213           ; if index == 5

                                  LDI                          120
                                  STW                          _fix_num                     ; fix_num=120

_endif_0x0049                     LDW                          _index
                                  XORI                         6
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x004a 2214           ; if index == 6

                                  LDI                          112
                                  STW                          _fix_num                     ; fix_num=(120+103)/2

_endif_0x004a                     LDW                          _index
                                  XORI                         7
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x004b 2215           ; if index == 7

                                  LDI                          103
                                  STW                          _fix_num                     ; fix_num=103

_endif_0x004b                     LDW                          _index
                                  XORI                         8
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x004c 2216           ; if index == 8

                                  LDI                          120
                                  STW                          _fix_num                     ; fix_num=(103+136)/2

_endif_0x004c                     LDW                          _index
                                  XORI                         9
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x004d 2217           ; if index == 9

                                  LDI                          136
                                  STW                          _fix_num                     ; fix_num=136

_endif_0x004d                     LDW                          _index
                                  XORI                         10
                                  CALLI                        convertEqOp
                                  CALLI                        _page_0x0aa0
_page_0x0aa0                      JumpFalse                    _endif_0x004e 2218           ; if index == 10

                                  LDI                          101
                                  STW                          _fix_num                     ; fix_num=(136+65)/2

_endif_0x004e                     LDW                          _index
                                  XORI                         11
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x004f 2219           ; if index == 11

                                  LDI                          65
                                  STW                          _fix_num                     ; fix_num=65

_endif_0x004f                     Return                                                    ; endproc

_fix_oct6                         PUSH                                                      ; proc fix_oct6

                                  LDW                          _index
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0050 2220           ; if index == 0

                                  LDI                          88
                                  STW                          _fix_num                     ; fix_num=88

_endif_0x0050                     LDW                          _index
                                  XORI                         1
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0051 2221           ; if index == 1

                                  LDI                          88
                                  STW                          _fix_num                     ; fix_num=(88+88)/2

_endif_0x0051                     LDW                          _index
                                  XORI                         2
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0052 2222           ; if index == 2

                                  LDI                          88
                                  STW                          _fix_num                     ; fix_num=88

_endif_0x0052                     LDW                          _index
                                  XORI                         3
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0053 2223           ; if index == 3

                                  CALLI                        _page_0x0ba0
_page_0x0ba0                      LDI                          90
                                  STW                          _fix_num                     ; fix_num=(88+91)/2

_endif_0x0053                     LDW                          _index
                                  XORI                         4
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0054 2224           ; if index == 4

                                  LDI                          91
                                  STW                          _fix_num                     ; fix_num=91

_endif_0x0054                     LDW                          _index
                                  XORI                         5
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0055 2225           ; if index == 5

                                  LDI                          62
                                  STW                          _fix_num                     ; fix_num=62

_endif_0x0055                     LDW                          _index
                                  XORI                         6
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0056 2226           ; if index == 6

                                  LDI                          88
                                  STW                          _fix_num                     ; fix_num=(62+113)/2

_endif_0x0056                     LDW                          _index
                                  XORI                         7
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0057 2227           ; if index == 7

                                  LDI                          113
                                  STW                          _fix_num                     ; fix_num=113

_endif_0x0057                     LDW                          _index
                                  XORI                         8
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0058 2228           ; if index == 8

                                  LDI                          85
                                  STW                          _fix_num                     ; fix_num=(113+56)/2

_endif_0x0058                     LDW                          _index
                                  XORI                         9
                                  CALLI                        _page_0x0ca0
_page_0x0ca0                      CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0059 2229           ; if index == 9

                                  LDI                          56
                                  STW                          _fix_num                     ; fix_num=56

_endif_0x0059                     LDW                          _index
                                  XORI                         10
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x005a 2230           ; if index == 10

                                  LDI                          49
                                  STW                          _fix_num                     ; fix_num=(56+42)/2

_endif_0x005a                     LDW                          _index
                                  XORI                         11
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x005b 2231           ; if index == 11

                                  LDI                          42
                                  STW                          _fix_num                     ; fix_num=42

_endif_0x005b                     Return                                                    ; endproc

_fix_oct7                         PUSH                                                      ; proc fix_oct7

                                  LDW                          _index
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x005c 2232           ; if index == 0

                                  LDI                          88
                                  STW                          _fix_num                     ; fix_num=88

_endif_0x005c                     LDW                          _index
                                  XORI                         1
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x005d 2233           ; if index == 1

                                  LDI                          88
                                  STW                          _fix_num                     ; fix_num=(88+88)/2

_endif_0x005d                     LDW                          _index
                                  XORI                         2
                                  CALLI                        convertEqOp
                                  CALLI                        _page_0x0da0
_page_0x0da0                      JumpFalse                    _endif_0x005e 2234           ; if index == 2

                                  LDI                          88
                                  STW                          _fix_num                     ; fix_num=88

_endif_0x005e                     LDW                          _index
                                  XORI                         3
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x005f 2235           ; if index == 3

                                  LDI                          90
                                  STW                          _fix_num                     ; fix_num=(88+91)/2

_endif_0x005f                     LDW                          _index
                                  XORI                         4
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0060 2236           ; if index == 4

                                  LDI                          91
                                  STW                          _fix_num                     ; fix_num=91

_endif_0x0060                     LDW                          _index
                                  XORI                         5
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0061 2237           ; if index == 5

                                  LDI                          62
                                  STW                          _fix_num                     ; fix_num=62

_endif_0x0061                     LDW                          _index
                                  XORI                         6
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0062 2238           ; if index == 6

                                  LDI                          88
                                  STW                          _fix_num                     ; fix_num=(62+113)/2

_endif_0x0062                     LDW                          _index
                                  XORI                         7
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0063 2239           ; if index == 7

                                  LDI                          113
                                  CALLI                        _page_0x0ea0
_page_0x0ea0                      STW                          _fix_num                     ; fix_num=113

_endif_0x0063                     LDW                          _index
                                  XORI                         8
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0064 2240           ; if index == 8

                                  LDI                          85
                                  STW                          _fix_num                     ; fix_num=(113+56)/2

_endif_0x0064                     LDW                          _index
                                  XORI                         9
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0065 2241           ; if index == 9

                                  LDI                          56
                                  STW                          _fix_num                     ; fix_num=56

_endif_0x0065                     LDW                          _index
                                  XORI                         10
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0066 2242           ; if index == 10

                                  LDI                          49
                                  STW                          _fix_num                     ; fix_num=(56+42)/2

_endif_0x0066                     LDW                          _index
                                  XORI                         11
                                  CALLI                        convertEqOp
                                  JumpFalse                    _endif_0x0067 2243           ; if index == 11

                                  LDI                          42
                                  STW                          _fix_num                     ; fix_num=42

_endif_0x0067                     Return                                                    ; endproc

_stop_music                       PUSH                                                      ; proc stop_music

_repeat_0x0068                    SoundAllOff                                               ; sound off

                                  WaitVBlank                                                ; wait

                                  BRA                          _repeat_0x0068               ; &forever

                                  Return                                                    ; endproc

_eatSound_Timer                   PUSH                                                      ; proc eatSound_Timer,tick_note

                                  LDI                          1
                                  ST                           giga_soundTimer              ; set SOUND_TIMER, 1

_wait_0                           LD                           giga_soundTimer
                                  CALLI                        convertGtOp
                                  CALLI                        _page_0x0fa0
_page_0x0fa0                      JumpFalse                    _endif_0x0069 2244           ; if 	get("SOUND_TIMER") > 0

                                  CALLI                        _wait_0                      ; goto wait_0

_endif_0x0069                     LDW                          _tick_sum
                                  ADDI                         1
                                  STW                          _tick_sum                    ; tick_sum=tick_sum+1

                                  LDWI                         0xff20
                                  STW                          memDstAddr
                                  LD                           giga_soundTimer
                                  DOKE                         memDstAddr
                                  INC                          memDstAddr
                                  INC                          memDstAddr
                                  LDW                          _tick_sum
                                  DOKE                         memDstAddr
                                  LSLW                         ; dummy                      ; gprintf "TIMER=%d,tick=%d",get("SOUND_TIMER"),tick_sum

                                  LDW                          _tick_sum
                                  XORW                         _eatSound_Timer_tick_note
                                  CALLI                        convertEqOp
                                  JumpFalse                    _else_0x006a 2246            ; if tick_sum==tick_note

                                  LDW                          _eatSound_Timer_tick_note
                                  STW                          _tick_note_ext               ; tick_note_ext=tick_note

                                  CALLI                        _endif_0x006b                ; else

_else_0x006a                      LDI                          1
                                  ST                           giga_soundTimer              ; set SOUND_TIMER, 1

                                  CALLI                        _wait_0                      ; goto wait_0

_endif_0x006b                     Return                                                    ; endproc

_beep                             PUSH                                                      ; proc beep,ch,note,vol,wave,Pitch_Bend

                                  LDW                          _beep_note
                                  STW                          mathX
                                  LDI                          12
                                  STW                          mathY
                                  CALLI                        divide16bit
                                  SUBI                         1
                                  STW                          _oct                         ; oct=note/12-1

                                  LDW                          _oct
                                  ADDI                         1
                                  STW                          0xe8
                                  LDI                          12
                                  STW                          mathX
                                  LDW                          0xe8
                                  STW                          mathY
                                  CALLI                        _page_0x10a0
_page_0x10a0                      CALLI                        multiply16bit
                                  STW                          0xe8
                                  LDW                          _beep_note
                                  SUBW                         0xe8
                                  STW                          _index                       ; index=note-12*(oct+1)

                                  CALLI                        _fix                         ; call fix

                                  LDWI                         32714
                                  ADDW                         _index
                                  PEEK                         
                                  STW                          0xea
                                  LDW                          _oct
                                  SUBI                         5
                                  STW                          0xec
                                  LDI                          12
                                  STW                          mathX
                                  LDW                          0xec
                                  STW                          mathY
                                  CALLI                        multiply16bit
                                  ADDW                         0xea
                                  STW                          musicNote
                                  GetMusicNote                 
                                  ADDW                         _fix_num
                                  ADDW                         _beep_Pitch_Bend
                                  STW                          _beep_n                      ; n = get("MUSIC_NOTE", peek(@enotes + index)+12*(oct-5))+fix_num+Pitch_Bend

                                  LDW                          _beep_ch
                                  ST                           sndChannel + 1
                                  LDW                          _beep_n
                                  STW                          sndFrequency
                                  LDW                          _beep_vol
                                  STW                          sndVolume
                                  LDW                          _beep_wave
                                  STW                          sndWaveType
                                  SoundOnV                                                  ; sound on, ch, n, vol, wave

                                  LDI                          1
                                  ST                           giga_soundTimer              ; set SOUND_TIMER, 1

                                  LDWI                         0xff20
                                  STW                          memDstAddr
                                  LD                           giga_soundTimer
                                  DOKE                         memDstAddr
                                  INC                          memDstAddr
                                  INC                          memDstAddr
                                  LDW                          _tick_sum
                                  DOKE                         memDstAddr
                                  CALLI                        _page_0x11a0
_page_0x11a0                      INC                          memDstAddr
                                  INC                          memDstAddr
                                  LDW                          _beep_ch
                                  DOKE                         memDstAddr
                                  INC                          memDstAddr
                                  INC                          memDstAddr
                                  LDW                          _beep_note
                                  DOKE                         memDstAddr
                                  INC                          memDstAddr
                                  INC                          memDstAddr
                                  LDW                          _beep_vol
                                  DOKE                         memDstAddr
                                  INC                          memDstAddr
                                  INC                          memDstAddr
                                  LDW                          _beep_wave
                                  DOKE                         memDstAddr
                                  INC                          memDstAddr
                                  INC                          memDstAddr
                                  LDW                          _tick_note_ext
                                  DOKE                         memDstAddr
                                  INC                          memDstAddr
                                  INC                          memDstAddr
                                  LDW                          _beep_n
                                  DOKE                         memDstAddr
                                  LSLW                         ; dummy                      ; gprintf "TIMER=%d,tick=%d,beep,%d,%d,%d,%d,%d,sound_frq=%d"	,get("SOUND_TIMER"),tick_sum,ch,note,vol,wave,tick_note_ext,n

                                  Return                                                    ; endproc

_music_data                       PUSH                                                      ; proc music_data

                                  LDI                          0x01
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,1

                                  LDI                          0x03
                                  STW                          0xc4
                                  LDI                          0x35
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,3,53,63,2,0

                                  LDI                          0x03
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,3

                                  LDI                          0x01
                                  STW                          0xc4
                                  CALLI                        _page_0x12a0
_page_0x12a0                      LDI                          0x48
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,1,72,63,2,0

                                  LDI                          0x02
                                  STW                          0xc4
                                  LDI                          0x3c
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,2,60,63,2,0

                                  LDI                          0x13
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,19

                                  LDI                          0x04
                                  STW                          0xc4
                                  LDI                          0x48
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,4,72,63,2,0

                                  LDI                          0x1b
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,27

                                  LDI                          1
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,1

                                  LDI                          0x01
                                  STW                          0xc4
                                  LDI                          0x4d
                                  CALLI                        _page_0x13a0
_page_0x13a0                      STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,1,77,63,2,0

                                  LDI                          0x2a
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,42

                                  LDI                          4
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,4

                                  LDI                          0x04
                                  STW                          0xc4
                                  LDI                          0x4d
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,4,77,63,2,0

                                  LDI                          0x38
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,56

                                  LDI                          1
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,1

                                  LDI                          0x01
                                  STW                          0xc4
                                  LDI                          0x4f
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,1,79,63,2,0

                                  LDI                          0x47
                                  CALLI                        _page_0x14a0
_page_0x14a0                      STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,71

                                  LDI                          0x04
                                  STW                          0xc4
                                  LDI                          0x4f
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,4,79,63,2,0

                                  LDI                          4
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,4

                                  LDI                          0x55
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,85

                                  LDI                          0x01
                                  STW                          0xc4
                                  LDI                          0x48
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,1,72,63,2,0

                                  LDI                          1
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,1

                                  LDI                          0x64
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,100

                                  LDI                          4
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,4

                                  LDI                          0x04
                                  STW                          0xc4
                                  LDI                          0x48
                                  CALLI                        _page_0x15a0
_page_0x15a0                      STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,4,72,63,2,0

                                  LDI                          0x02
                                  STW                          0xc4
                                  LDI                          0x40
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,2,64,63,2,0

                                  LDI                          2
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,2

                                  LDI                          0x73
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,115

                                  LDI                          0x01
                                  STW                          0xc4
                                  LDI                          0x52
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,1,82,63,2,0

                                  LDI                          1
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,1

                                  LDI                          3
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,3

                                  LDI                          0x03
                                  CALLI                        _page_0x16a0
_page_0x16a0                      STW                          0xc4
                                  LDI                          0x32
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,3,50,63,2,0

                                  LDI                          0x81
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,129

                                  LDI                          4
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,4

                                  LDI                          0x04
                                  STW                          0xc4
                                  LDI                          0x52
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,4,82,63,2,0

                                  LDI                          0x8f
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,143

                                  LDI                          2
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,2

                                  LDI                          0x02
                                  STW                          0xc4
                                  LDI                          0x3e
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _page_0x17a0
_page_0x17a0                      CALLI                        _beep                        ; call beep,2,62,63,2,0

                                  LDI                          0xad
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,173

                                  LDI                          2
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,2

                                  LDI                          0x02
                                  STW                          0xc4
                                  LDI                          0x40
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,2,64,63,2,0

                                  LDI                          0xc9
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,201

                                  LDI                          0x02
                                  STW                          0xc4
                                  LDI                          0x43
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,2,67,63,2,0

                                  LDI                          2
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,2

                                  LDI                          0x01
                                  STW                          0xc4
                                  LDI                          0x4f
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  CALLI                        _page_0x18a0
_page_0x18a0                      LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,1,79,63,2,0

                                  LDI                          1
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,1

                                  LDI                          0xd9
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,217

                                  LDI                          4
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,4

                                  LDI                          0x04
                                  STW                          0xc4
                                  LDI                          0x4f
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,4,79,63,2,0

                                  LDI                          0xe7
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,231

                                  LDI                          2
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,2

                                  LDI                          0x02
                                  STW                          0xc4
                                  LDI                          0x3e
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,2,62,63,2,0

                                  LDI                          0x01
                                  STW                          0xc4
                                  CALLI                        _page_0x19a0
_page_0x19a0                      LDI                          0x4d
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,1,77,63,2,0

                                  LDI                          1
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,1

                                  LDI                          0x03
                                  STW                          0xc4
                                  LDI                          0x2e
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,3,46,63,2,0

                                  LDI                          3
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,3

                                  LDI                          0xf5
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,245

                                  LDI                          4
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,4

                                  LDI                          0x04
                                  STW                          0xc4
                                  LDI                          0x4d
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,4,77,63,2,0

                                  CALLI                        _page_0x1aa0
_page_0x1aa0                      LDWI                         0x0103
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,259

                                  LDI                          0x02
                                  STW                          0xc4
                                  LDI                          0x40
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,2,64,63,2,0

                                  LDI                          2
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,2

                                  LDWI                         0x0121
                                  STW                          0xc4
                                  CALLI                        _eatSound_Timer              ; call eatSound_Timer,289

                                  LDI                          2
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,2

                                  LDI                          0x02
                                  STW                          0xc4
                                  LDI                          0x43
                                  STW                          0xc6
                                  LDI                          0x3f
                                  STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,2,67,63,2,0

                                  LDI                          1
                                  ST                           sndChannel + 1
                                  SoundOff                                                  ; sound off,1

                                  LDI                          0x01
                                  STW                          0xc4
                                  LDI                          0x4f
                                  STW                          0xc6
                                  LDI                          0x3f
                                  CALLI                        _page_0x1ba0
_page_0x1ba0                      STW                          0xc8
                                  LDI                          0x02
                                  STW                          0xca
                                  LDI                          0x00
                                  STW                          0xcc
                                  CALLI                        _beep                        ; call beep,1,79,63,2,0

                                  Return                                                    ; endproc

                                  HALT                                                      ; END



;*************************************************************************************************************
;*************************************************************************************************************
;* Internal runtime, DO NOT MODIFY PAST THIS POINT, modifications must be made in the original include files *
;*************************************************************************************************************
;*************************************************************************************************************

romCheck                          EQU     0xfd4a
convertEqOp                       EQU     0xfd03
convertGtOp                       EQU     0xfc96
multiply16bit                     EQU     0xfd9f
divide16bit                       EQU     0xfeac
waitVBlank                        EQU     0xfcae
resetVideoFlags                   EQU     0xfe02
initClearFuncs                    EQU     0xfc9f
clearVertBlinds                   EQU     0xfdcd
clearCursorRow                    EQU     0xfd73
musicGetNote                      EQU     0xfd0c
soundAllOff                       EQU     0xfce9
soundOff                          EQU     0xfc8d
soundOnV                          EQU     0xfd22
printInit                         EQU     0xfcd3
printText                         EQU     0xfcbe
printChar                         EQU     0xfe0d
printClip                         EQU     0xff08
newLineScroll                     EQU     0xfe59



realTimeAddr        EQU     register0
realTimeProc0       EQU     register1
realTimeProc1       EQU     register2
realTimeProc2       EQU     register3
numericLabel        EQU     register0
defaultLabel        EQU     register1
lutLabs             EQU     register2
lutAddrs            EQU     register3
lutIndex            EQU     register8
romUser             EQU     register0                       
romType             EQU     register1                       
romReadAddr         EQU     register0
romErrAddr          EQU     0x7E                            
vramErrAddr         EQU     0x0101

romErrAddr          DW      vramErrAddr



romCheck            LD      giga_romType
                    ANDI    0xFC
                    STW     romType
                    SUBW    romUser
                    BEQ     romC_return                     
                    LDW     romUser
                    SUBI    0x80                            
                    BNE     romC_check
                    LDW     romType
                    SUBW    romUser
                    BEQ     romC_return                     
                    BRA     romC_fail
                    
romC_check          LDW     romType                         
                    SUBW    romUser
                    BGT     romC_return                     
                     
romC_fail           LD      giga_rand0
                    POKE    romErrAddr                      
                    BRA     romC_fail

romC_return         RET


                    
convertEqOp         BEQ     convertEq_1
                    LDI     0
                    RET
convertEq_1         LDI     1
                    RET


                    
convertGtOp         BGT     convertGt_1
                    LDI     0
                    RET
convertGt_1         LDI     1
                    RET



mathX               EQU     register8
mathY               EQU     register9
mathSum             EQU     register12
mathRem             EQU     register12
mathMask            EQU     register13
mathSign            EQU     register14
mathQuot            EQU     register15
mathShift           EQU     register15
mathBase            EQU     register10
mathPow             EQU     register11
mathResult          EQU     register14


                    
multiply16bit       LDI     0
                    STW     mathSum
                    LDW     mathX
                    BEQ     multiply16_exit     
                    LDWI    SYS_LSRW1_48
                    STW     giga_sysFn
                    LDW     mathY
                    
multiply16_loop     BEQ     multiply16_exit     
                    ANDI    1
                    BEQ     multiply16_skip
                    LDW     mathSum
                    ADDW    mathX
                    STW     mathSum             
                    
multiply16_skip     LDW     mathX
                    LSLW
                    STW     mathX               
                    LDW     mathY
                    SYS     48
                    STW     mathY               
                    BRA     multiply16_loop

multiply16_exit     LDW     mathSum
                    RET


                    
divide16bit         LDW     mathX
                    XORW    mathY
                    STW     mathSign
                    LDW     mathX
                    BGE     divide16_pos0
                    LDI     0
                    SUBW    mathX
                    STW     mathX
                    
divide16_pos0       LDW     mathY                     
                    BGE     divide16_pos1
                    LDI     0
                    SUBW    mathY
                    STW     mathY
                    
divide16_pos1       LDI     0
                    STW     mathRem
                    LDI     1
    
divide16_loop       STW     mathMask
                    LDW     mathRem
                    LSLW
                    STW     mathRem
                    LDW     mathX
                    BGE     divide16_incr
                    INC     mathRem
                    
divide16_incr       LDW     mathX
                    LSLW
                    STW     mathX
                    LDW     mathRem
                    SUBW    mathY
                    BLT     divide16_incx
                    STW     mathRem
                    INC     mathX
                    
divide16_incx       LDW     mathMask
                    LSLW
                    BNE     divide16_loop
                    LDW     mathSign
                    BGE     divide16_exit
                    LDI     0
                    SUBW    mathX
                    RET
                    
divide16_exit       LDW     mathX
                    RET



graphicsMode        EQU     register0
waitVBlankNum       EQU     register0

drawHLine_x1        EQU     register0
drawHLine_y1        EQU     register1
drawHLine_x2        EQU     register2

drawVLine_x1        EQU     register0
drawVLine_y1        EQU     register1
drawVLine_y2        EQU     register2
drawVLine_y8        EQU     register3

drawLine_x1         EQU     register0
drawLine_y1         EQU     register1
drawLine_x2         EQU     register2
drawLine_y2         EQU     register3
drawLine_xy1        EQU     register0
drawLine_xy2        EQU     register1
drawLine_dxy1       EQU     register2
drawLine_dxy2       EQU     register3
drawLine_dx1        EQU     register8
drawLine_dy1        EQU     register9
drawLine_dx2        EQU     register10
drawLine_dy2        EQU     register11
drawLine_sx         EQU     register12
drawLine_sy         EQU     register13
drawLine_h          EQU     register14
drawLine_num        EQU     register15
drawLine_count      EQU     register14
drawLine_tmp        EQU     register15
drawLine_dx         EQU     register2
drawLine_dy         EQU     register3
drawLine_u          EQU     register8
drawLine_v          EQU     register9
drawLine_addr       EQU     register10
drawLine_ddx        EQU     register11
drawLine_cnt        EQU     register12
drawLine_swp        EQU     register13
drawLine_xy         EQU     register7

readPixel_xy        EQU     register0
drawPixel_xy        EQU     register0

drawCircle_cycx     EQU     register0
drawCircle_r        EQU     register2
drawCircle_a        EQU     register3
drawCircle_d        EQU     register8
drawCircle_x        EQU     register9
drawCircle_y        EQU     register10
drawCircle_ch0      EQU     register11
drawCircle_ch1      EQU     register12
drawCircle_ch2      EQU     register13
drawCircle_ch3      EQU     register14

drawCircleF_x1      EQU     register0
drawCircleF_y1      EQU     register1
drawCircleF_x2      EQU     register2
drawCircleF_cx      EQU     register15
drawCircleF_cy      EQU     register10
drawCircleF_r       EQU     register11
drawCircleF_v       EQU     register8
drawCircleF_w       EQU     register9

drawRect_x1         EQU     register7
drawRect_y1         EQU     register10
drawRect_x2         EQU     register11
drawRect_y2         EQU     register16

drawRectF_x1        EQU     register0
drawRectF_y1        EQU     register1
drawRectF_x2        EQU     register2
drawRectF_y2        EQU     register8

drawPoly_addr       EQU     register7
drawPoly_mode       EQU     register14

    
%if VBLANK_INTERRUPT
waitVBlank          LD      timerJiff + 1                       
%else
waitVBlank          LD      giga_frameCount
%endif
                    XORW    frameCountPrev
                    BEQ     waitVBlank
%if VBLANK_INTERRUPT
                    LD      timerJiff + 1                       
%else
                    LD      giga_frameCount
%endif
                    STW     frameCountPrev
                    RET



xreset              EQU     register0
xcount              EQU     register1
ycount              EQU     register2
treset              EQU     register3
breset              EQU     register8
top                 EQU     register9
bot                 EQU     register10
vramAddr            EQU     register11
evenAddr            EQU     register12
clsAddress          EQU     register13
clsLines            EQU     register14
varAddress          EQU     register13
clrAddress          EQU     register13
clrLines            EQU     register14
clrWidth            EQU     register15
ramAddr0            EQU     register14
ramAddr1            EQU     register15


resetVideoFlags     LDI     giga_CursorX                    
                    STW     cursorXY
                    LD      miscFlags
                    ANDI    MISC_ON_BOTTOM_ROW_MSK
                    ST      miscFlags                       
                    RET



initClearFuncs      PUSH
                    CALLI   resetVideoFlags
                    LDWI    SYS_SetMemory_v2_54             
                    STW     giga_sysFn
                    LD      fgbgColour
                    ST      giga_sysArg1                    
                    POP
                    RET


                    
clearVertBlinds     PUSH
                    CALLI   initClearFuncs
                    LDI     giga_vram >> 8
                    STW     top  
                    
clearVB_loopy       LDI     giga_xres
                    ST      giga_sysArg0
                    LDI     0
                    ST      giga_sysArg2                    
                    LD      top
                    ST      giga_sysArg3                    
                    SYS     54                              
    
                    LDI     giga_xres
                    ST      giga_sysArg0
                    LDI     0
                    ST      giga_sysArg2                    
                    LDWI    giga_yres - 1 + 16
                    SUBW    top
                    ST      giga_sysArg3                    
                    SYS     54                              
                    INC     top                             
                    LD      top
                    SUBI    giga_yres / 2 + 8
                    BLT     clearVB_loopy
                    POP
                    RET


midiId              EQU     register0
audioAddr           EQU     register1
waveType            EQU     register2
midiNote            EQU     register4                       
midiCommand         EQU     register5
midiPtr             EQU     register6
sndChannel          EQU     register8
sndFrequency        EQU     register9
sndVolume           EQU     register10
sndWaveType         EQU     register11
musicStream         EQU     register8
musicNote           EQU     register9
musicCommand        EQU     register10
musicPtr            EQU     register11


musicGetNote        LDWI    giga_notesTable
                    ADDW    musicNote
                    ADDW    musicNote
                    STW     musicPtr
                    LUP     0x00                            
                    ST      musicNote
                    LDW     musicPtr
                    LUP     0x01                            
                    ST      musicNote + 1
                    LDW     musicNote                       
                    RET


soundAllOff         LDWI    0x01FC
                    STW     sndChannel
                    LDI     0
                    DOKE    sndChannel                      
                    INC     sndChannel + 1      
                    DOKE    sndChannel                      
                    INC     sndChannel + 1      
                    DOKE    sndChannel                      
                    INC     sndChannel + 1      
                    DOKE    sndChannel                      
                    RET


soundOff            LDI     0xFC
                    ST      sndChannel
                    LDI     0
                    DOKE    sndChannel                      
                    RET


soundOnV            LDWI    SYS_LSRW1_48
                    STW     giga_sysFn
                    LDI     0xFC
                    ST      sndChannel
                    LD      sndFrequency
                    SYS     48
                    ST      sndFrequency                    
                    LDW     sndFrequency                    
                    DOKE    sndChannel                      
                    LDI     0xFA
                    ST      sndChannel                      
                    LDI     63
                    SUBW    sndVolume
                    ADDI    64
                    POKE    sndChannel                      
                    INC     sndChannel
                    LD      sndWaveType
                    ANDI    3
                    POKE    sndChannel                      
                    RET




textStr             EQU     register0
textNum             EQU     register0
textBak             EQU     register0
textHex             EQU     register1
textSpc             EQU     register1
textLen             EQU     register2
textOfs             EQU     register3
textChr             EQU     register8
textFont            EQU     register9
textSlice           EQU     register10
scanLine            EQU     register11
digitMult           EQU     register12
digitIndex          EQU     register13
clearLoop           EQU     register14
    
    
printInit           LDWI    SYS_VDrawBits_134
                    STW     giga_sysFn
                    LDW     fgbgColour
                    STW     giga_sysArg0
                    LD      cursorXY + 1                        
                    LSLW
                    INC     giga_vAC + 1
                    PEEK
                    ST      giga_sysArg4 + 1
                    LD      cursorXY
                    ST      giga_sysArg4                        
                    RET



                    
printText           PUSH
                    STW     textStr
                    CALLI   printInit

                    
printT_char         INC     textStr                             
                    LDW     textStr             
                    PEEK
                    BEQ     printT_exit                         
                    CALLI   printChar
                    BRA     printT_char
                    
printT_exit         POP
                    RET



                    
printChar           SUBI    130                                 
                    BGT     printC_exit
                    ADDI    130
                    SUBI    82
                    BGE     printC_text82
                    ADDI    50
                    BLT     printC_exit                         
                    STW     textChr                             
                    LDWI    giga_text32                         
                    BRA     printC_font
                    
printC_text82       STW     textChr                             
                    LDWI    giga_text82                         
                    
printC_font         STW     textFont
                    LD      textChr
                    LSLW    
                    LSLW    
                    ADDW    textChr
                    ADDW    textFont
                    STW     textFont                            
                    LDI     0x05

printC_slice        ST      textSlice
                    LDW     textFont                            
                    LUP     0x00                                
                    ST      giga_sysArg2
                    SYS     134                                 
                    INC     textFont                            
                    INC     giga_sysArg4                        
                    LD      textSlice
                    SUBI    1
                    BNE     printC_slice
                    
                    ST      giga_sysArg2                        
                    SYS     134                                 
                    INC     giga_sysArg4                        
                    
                    PUSH
                    CALLI   printClip
                    POP
                    
printC_exit         RET


printClip           LD      cursorXY
                    ADDI    giga_xfont
                    ST      cursorXY
                    SUBI    giga_xres - giga_xfont              
                    BLE     printCl_exit
                    LD      miscFlags
                    ANDI    MISC_DISABLE_CLIP_BIT
                    BNE     printCl_exit                        
                    PUSH
                    CALLI   newLineScroll                       
                    POP
                    
printCl_exit        RET



                    
clearCursorRow      PUSH
                    LDWI    SYS_SetMemory_v2_54
                    STW     giga_sysFn                          
                    LD      fgbgColour
                    ST      giga_sysArg1                        
                    LDWI    giga_videoTable
                    PEEK
                    ST      giga_sysArg3                        
                    LDI     giga_yfont

clearCR_loopy       ST      clearLoop                    
                    LDI     giga_xres
                    ST      giga_sysArg0
                    LDI     0
                    ST      giga_sysArg2                        
                    SYS     54                                  
                    INC     giga_sysArg3                        
                    LD      clearLoop
                    SUBI    1
                    BNE     clearCR_loopy
                    CALLI   printInit                           
                    POP
                    RET


                    
newLineScroll       LDI     giga_CursorX                        
                    ST      cursorXY
                    ST      giga_sysArg4
                    LD      miscFlags
                    ANDI    MISC_ENABLE_SCROLL_BIT
                    BNE     newLS_cont0                         
                    RET
                    
newLS_cont0         PUSH
                    LD      miscFlags
                    ANDI    MISC_ON_BOTTOM_ROW_BIT
                    BNE     newLS_cont1                         
                    LD      cursorXY + 1
                    ADDI    giga_yfont
                    ST      cursorXY + 1
                    SUBI    giga_yres
                    BLT     newLS_exit
                    LDI     giga_yres - giga_yfont
                    ST      cursorXY + 1
                    
newLS_cont1         CALLI   clearCursorRow
                    LDWI    giga_videoTable
                    STW     scanLine
    
newLS_scroll        LDW     scanLine
                    PEEK
                    ADDI    giga_yfont
                    SUBI    0x7F
                    BLE     newLS_adjust
                    ADDI    0x88
                    
newLS_adjust        ADDI    0x7F
                    POKE    scanLine
                    INC     scanLine                            
                    INC     scanLine
                    LD      scanLine
                    SUBI    0xF0                                
                    BLT     newLS_scroll
                    LD      miscFlags
                    ORI     MISC_ON_BOTTOM_ROW_BIT
                    ST      miscFlags                           
                    
newLS_exit          CALLI   printInit                           
                    POP
                    RET

